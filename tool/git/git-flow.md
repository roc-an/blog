# 深入理解 Git 工作流

软件开发不是单打独斗，绝大多数项目都是由多人协作完成的。但是，人数多起来以后，一些问题便接踵而至：

* 如何确保代码在不同开发者间能做到及时更新和同步？
* 代码是否可以回溯到某个版本？
* 不同人修改了同一份文件的同一块代码怎么办？
* 作为项目管理者如何高效地组织、审查成员代码？
* ...

要想优雅地处理好这些问题，就要用到代码版本控制工具了，而 Git，无疑是目前首选。

Git 诞生自 Linux 社区，社区团队在研发 Git 系统时制定了以下几个核心目标：

* 速度
* 简单的设计
* 对非线性开发模式的强力支持（允许成千上万个并行开发的分支）
* 完全分布式
* 有能力高效管理类似 Linux 内核一样的超大规模项目（速度和数据量）

## 深入 Git 常用指令

从产生文件变更，到更新远程仓库，要经历 4 个阶段：工作区 -> 暂存区 -> 本地仓库 -> 远程仓库

* 工作区：从 Git 压缩数据库中提取出来的某个版本的内容，在磁盘上可以修改；
* 暂存区：本质上是一个记录了下次要提交内容的文件列表信息的文件，术语也叫“索引”；
* 本地仓库：也叫 Git 目录（.git directory），存储各版本 Commit 的快照；

Git 文件有 3 种状态：

* 已修改：对文件进行了修改，但还没有保存到本地数据库中；
* 已暂存：对已修改的文件的版本做了标记，使它包含在了下次提交的快照中；
* 已提交：数据已保存到本地数据库中；

### `git pull` 与 `git fetch`

### `git commit -m` 与 `git commit --amend -m`

* `git commit -m <msg>`: 这个指令非常常用，`-m` 后跟提交的信息即可，比如：`git commit -m "feat: 完成登录功能"`；
* `git commit --amend`：修改当前分支的上一次 commit 信息，在命令行中执行会调出自带的 Vim 编辑器。当然，也可以 `git commit --amend -m <msg>` 这样直接修改信息而不用调出 Vim。当你 commit 后后悔了，要再修改一下之前的 commit 信息时可以使用它。

## Git 与 SVN 的区别

**SVN 是集中式的，而 Git 是分布式的**

集中式的版本控制系统（Centralized Version Control System，简称 CVCS），比如 SVN、CVS、Perforce 等，都有一个单一的集中管理的服务器。服务器上保存着所有文件的修订版本，协作的程序员通过自己的客户端连接这台服务器来获取最新的文件或者提交更新。

但是这种集中式的方案有一个致命的问题，一旦中央服务期出现单点故障，比如宕机一段时间，那这段时间内所有开发者都没法提交更新了，也就没法互相同步新代码了。如果想的更极端一点，服务器炸了，所有版本历史记录都在这台服务器上，那历史记录这些也没了，只剩下各自开发者电脑上的单独版本的代码了。

而 Git 采用的是「分布式版本控制系统」（Distributed Version Control System，简称 DVCS），除 Git 外，Mercurial、Bazaar 以及 Darcs 等也都是分布式的。

分布式意味着各个开发者在初始 clone 或者后续拉取更新的时候，不仅仅获取最新的文件快照，而是将整个仓库都镜像下来，这也包括完整的提交历史记录。这样即便托管代码的服务器故障了，也可以从任意客户端处恢复。

**SVN 是基于差异式的版本控制，而 Git 是基于快照流：**

从原理上讲，Git 对待存储数据的方式与 SVN（Subversion）及其他版本控制工具（CVS、Perforce、Bazaar 等）是截然不同的。

以 SVN 为代表的这类版本控制工具，它们存储数据的方式是「基于差异」（Delta-Based）的。这种方式下，先存储最原始的基本文件，一旦文件发生修改并提交后，就将它与原始文件的差异保存下来。这样随着时间的累积，就会存储越来越多的文件差异。

而 Git 对待存储的数据是采用「快照流」的方式。每次提交后，Git 会对当前项目的全部文件创建一个快照。为了效率，如果文件没被修改，那么 Git 不会重新储存该文件，而是保存一个指向之前存储的该文件的链接。

**Git 的大部分操作都可以本地完成**

clone 或从远程仓库更新后，Git 项目的完整内容都保存在电脑的本地磁盘中，随时都可以查看完整的历史提交记录，而不用联网从远程服务器获取。

如果使用 SVN，虽然可以在本地修改文件，但是却得联网后才能提交修改。比如你这会儿正在坐飞机，没有网，那只能飞机中这段时间的所有变更都作为 1 次提交在到家联网后提交上去，这是非常麻烦的。而使用 Git 可以在本地任意提交，等有网时再 push 更新远程仓库就好了。

## Todo List

- [ ] 补充 SVN 是基于差异式的版本控制 的图；
- [ ] 快照原理补充
