# JS 中的相等性判断

程序员大多是有着一颗追求完美的心的，所以为什么 FaceBook 办公室有这样一条标语——Done is better than perfect，比完美更重要的是完成。

而且往往不仅追求完美，我们还恪守严谨。就比如平时写代码，写 `===` 大多好于写 `==`，码着严谨的代码，心里也就逐渐踏实了很多。

但殊不知 `===`（叫“严格等于”）也有不够严格的时候，就比如：

``` js
NaN === NaN // false
+0 === -0 // true
```

我第一次见到上面这结果也是一脸懵逼的，虽然平时写业务几乎碰不到，但没办法，偶尔有些笔试题里还是会蹦出来这些让你心里咯噔一下。

由于严格等于不够严格，于是 ES6 中新增了个对象方法 `Object.is(val1, val2)`，它与 `===` 的判等行为基本一致，只不过对于 `NaN` 和 `+0`、`-0` 来说：

``` js
Object.is(NaN, NaN) // true
Object.is(+0, -0) // false
```

有了 `Object.is()`，终于能够所想即所得了。

但关于“JS 中相等性判断”，似乎还有很多门道，于是写了这篇文章来深入推敲这个话题。

## （一）隐式转换

在了解相等性比较前，还得先从 JS 中的隐式转换说起。来看一行例子：

`console.log('b'+'a'+ +'a'+'a') // => "baNaNa"`

这个执行结果对于初接触 JS 的人是不太友好的，就好像一个老外在做中文听力题，还是方言版的...

之所以会出现上面这种匪夷所思的结果，是因为 **JS 在进行运算符操作（如 `+`、`-`、`*`、`/`）、条件判断（如 `if`、`while`）还有相等性比较（如 `==`）时，都会进行类型的隐式转换。**

几个容易理解的例子：

``` js
3 + " 个大西瓜" // => "3 个大西瓜"。数字 3 转成了字符串
"2" * "5" // => 10。字符串都转成了数字
1 - "x" // => NaN。字符串 "x" 没法转成数字
```

出现 `NaN` 是因为比如把字符串 `"x"` 转换成数字这种是没意义的。

[`NaN`](https://developer.mozilla.org/en-US/docs/Glossary/NaN)，Not a Number，非数字值，通常是在数学计算失败或者解析字符串成数字失败时出现，通过 `0/0` 就能得到 `NaN`，通过 [`isNaN()`](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/isNaN) 来检验一个值是否是 `NaN`。

结合着隐式类型转换，JS 中也有如下一些奇技淫巧：

``` js
+"28" // => 28。一元 + 尝试将操作数转数字
!!"28" // => true。一元 ! 尝试将操作数转布尔并取反，这里注意是双叹号
28+"" // => "28"。数字和字符串相加，数字会转字符串
```

使用这些奇技淫巧虽然代码量少了，但同时可读性也低了。平时写业务还是乖乖用 `Boolean()`、`Number()`、`String()` 这些做显式类型转换来得好些，毕竟代码是拿来给机器执行的，也是拿来给人读的：

``` js
Number("28") // => 28
Boolean("28") // => true
String(28) // => "28"
```

现在再来看 `console.log('b'+'a'+ +'a'+'a') // => "baNaNa"` 的执行结果就没那么惊讶了，关键在中间有个 `+"a"`：

`+"a" // => NaN`

得到 `NaN` 后再与其他字符串拼接，`NaN` 隐式转换成了字符串 `"NaN"`，拼接后最终结果为 `"baNaNa"`。

## （二）相等性比较算法

啥？我要比较个相等不相等，也需要算法？？？还真需要，而且在 ECMAScript 标准中还明确列出了这些相等性比较的算法。这里我把它们索引出来：

* [严格相等比较算法](https://262.ecma-international.org/5.1/#sec-11.9.6)
* [非严格相等比较算法](https://262.ecma-international.org/5.1/#sec-11.9.3)
* [同值算法](https://262.ecma-international.org/5.1/#sec-9.12)

读史使人明智，读算法使人头晕。不过了解算法还是对我们写代码很有帮助的，况且一旦看进去，往往也就没想象中困难了。