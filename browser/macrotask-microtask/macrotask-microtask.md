# 宏任务与微任务

## （一）消息队列与事件循环机制

在浏览器多进程架构中，渲染进程是专门用来将 HTML/CSS/JS 解析、渲染成页面的。排版引擎 Blink 和 V8 引擎都运行在渲染进程中：

![浏览器多进程架构](https://user-images.githubusercontent.com/79783808/117564223-abb5a000-b0dd-11eb-8ce1-67cd70d93bb1.png)

渲染进程负责调度相关线程来完成渲染任务。

渲染进程中的**渲染主线程**要做的事情非常多：

* 解析 HTML 成 DOM；
* 进行样式计算；
* 进行布局计算；
* 处理 JS 任务；
* 处理鼠标点击、键盘输入等输入事件；
* 等等...

**消息队列与事件循环机制就是为了确保渲染进程中线程的任务能够有条不紊地执行。**

消息队列、事件循环在渲染进程中是这样的：

如图，其中涉及到：

* 渲染进程中：
  * 渲染主线程及其事件循环机制；
  * 消息队列；
  * I/O（I-Input，O-Output，输入/输出）线程；
* 渲染进程接收到来自其他进程（如网络进程、浏览器主进程）的任务；

其中涉及到**浏览器多进程架构**的背景知识，也可以通过 [从浏览器地址栏中输入 URL 到看到页面，中间经历了什么？](https://github.com/roc-an/blog/issues/3) 这篇文章来简单了解。

我们先通过上图对渲染进程及其内部构造有个简单了解，接下来对其中的关键细节进行说明。

